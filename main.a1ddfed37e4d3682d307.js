(self.webpackChunkclient=self.webpackChunkclient||[]).push([[792],{2406:function(e,t,r){"use strict";var n=r(4489),o=r(4349),s=r.n(o),i=r(2181),a=r(674),c=r(5862),l=r(7097);var d=()=>{const[e,t]=(0,o.useState)({isAuthenticated:!1,isLoading:!0});return(0,o.useEffect)(()=>{const e=localStorage.getItem("token");t({isAuthenticated:null!==e,isLoading:!1})},[]),e},h=r(3665);const{Content:u}=l.A;var p=({children:e})=>{const{isAuthenticated:t,isLoading:r}=d(),s=(0,h.Zp)(),i=(0,h.zy)();return(0,o.useEffect)(()=>{r||t||"/login"===i.pathname||s("/login")},[t,r,i.pathname,s]),r?(0,n.jsx)("div",{children:"验证身份中..."}):t?(0,n.jsx)(l.A,{children:(0,n.jsx)(u,{children:t?(0,n.jsx)(h.sv,{}):null})}):null},f=r(9751);const m=(0,o.createContext)(null),g=m.Provider,j=()=>{const e=(0,o.useContext)(m);if(!e)throw new Error("useStore must be used within a StoreProvider");return e},{Content:y}=l.A;var x=(0,f.PA)(({children:e})=>{j();return(0,n.jsx)(l.A,{children:(0,n.jsxs)(y,{children:[" ",(0,n.jsx)(h.sv,{})]})})}),v=r(5791),k=r(3522);const{Header:A,Content:b,Footer:w}=l.A;var I=({children:e})=>(0,n.jsxs)(l.A,{className:"layout",children:[(0,n.jsxs)(A,{children:[(0,n.jsx)("div",{className:"logo"}),(0,n.jsxs)(v.A,{theme:"dark",mode:"horizontal",children:[(0,n.jsx)(v.A.Item,{icon:(0,n.jsx)(k.A,{}),children:(0,n.jsx)(h.N_,{to:"/",children:"首页"})},"1"),(0,n.jsx)(v.A.Item,{icon:(0,n.jsx)(c.A,{}),children:(0,n.jsx)(h.N_,{to:"/profile",children:"个人中心"})},"2")]})]}),(0,n.jsx)(b,{style:{padding:"0 50px"},children:(0,n.jsx)("div",{className:"site-layout-content",children:(0,n.jsx)(h.sv,{})})}),(0,n.jsx)(w,{style:{textAlign:"center"},children:"Ant Design ©2024 Created by Ant UED"})]}),O=r(9914),S=r(6775),T=r(8134),R=r(7920);var L=()=>{const e=j(),{isLoggedIn:t,login:r,error:o}=e.LoginStore;return(0,n.jsxs)(S.A,{name:"login",initialValues:{remember:!0},onFinish:async e=>{await r(e.username,e.password),t?(O.Ay.success("登录成功"),window.location.href="/"):O.Ay.error(o||"登录失败，请检查用户名和密码")},style:{maxWidth:300,margin:"0 auto",paddingTop:"100px"},children:[(0,n.jsx)(S.A.Item,{name:"username",rules:[{required:!0,message:"请输入用户名!"}],children:(0,n.jsx)(T.A,{prefix:(0,n.jsx)(c.A,{className:"site-form-item-icon"}),placeholder:"用户名"})}),(0,n.jsx)(S.A.Item,{name:"password",rules:[{required:!0,message:"请输入密码!"}],children:(0,n.jsx)(T.A,{prefix:(0,n.jsx)(R.A,{className:"site-form-item-icon"}),type:"password",placeholder:"密码"})}),(0,n.jsx)(S.A.Item,{children:(0,n.jsx)(a.Ay,{type:"primary",htmlType:"submit",style:{width:"100%"},children:"登录"})})]})};var C=()=>{const[e,t]=s().useState(0);return(0,n.jsx)(h.I9,{children:(0,n.jsxs)(h.BV,{children:[(0,n.jsx)(h.qh,{path:"/login",element:(0,n.jsx)(L,{})}),(0,n.jsx)(h.qh,{element:(0,n.jsx)(p,{}),children:(0,n.jsx)(h.qh,{element:(0,n.jsx)(x,{}),children:(0,n.jsx)(h.qh,{element:(0,n.jsx)(I,{}),children:(0,n.jsx)(h.qh,{path:"/",element:(0,n.jsxs)("div",{className:"app-container",children:[(0,n.jsx)("h1",{className:"app-title",children:"React + TypeScript + Ant Design"}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)(c.A,{className:"icon"}),(0,n.jsxs)("p",{children:["点击按钮计数：",e]}),(0,n.jsx)(a.Ay,{type:"primary",onClick:()=>{t(e=>e+1)},children:"增加"})]})]})})})})})]})})},N=r(3675);const P=new class{constructor(){(0,N.Gn)(this),this.importStores()}importStores(){const e=r(8559);e.keys().forEach(t=>{const r=e(t),n=t.match(/\.\/(\w+)\.store\.(ts|js)$/)?.[1];if(n&&r.default){const e=r.default;this[`${n}Store`]=new e}})}};i.createRoot(document.getElementById("root")).render((0,n.jsx)(s().StrictMode,{children:(0,n.jsx)(g,{value:P,children:(0,n.jsx)(C,{})})}))},5316:function(e,t,r){"use strict";r.r(t);var n=r(3675),o=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},s=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class i{data=[];constructor(){(0,n.Gn)(this)}fetchData=()=>{this.data=[1,2,3]}}o([n.sH,s("design:type",Array)],i.prototype,"data",void 0),o([n.XI,s("design:type",Object)],i.prototype,"fetchData",void 0),t.default=i},6260:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var n=r(3675),o=r(7710),s=r(3665);const i=o.A.create({baseURL:void 0,timeout:1e4});i.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,async e=>{const t=e.config,r=(0,s.Zp)();if(e.response){if(401===e.response.status&&!t._retry){t._retry=!0;try{const o=localStorage.getItem("refreshToken");if(!o)return r("/login"),Promise.reject(e);const{data:s}=await i.post("/api/refresh-token",{refreshToken:o}),a=s.token,c=s.refreshToken;return n=a,localStorage.setItem("token",n),(e=>{localStorage.setItem("refreshToken",e)})(c),t.headers.Authorization=`Bearer ${a}`,i(t)}catch(e){return r("/login"),Promise.reject(e)}}403===e.response.status&&r("/login")}var n;return Promise.reject(e)});var a={get:(e,t)=>i.get(e,t).then(e=>e.data),post:(e,t,r)=>i.post(e,t,r).then(e=>e.data),put:(e,t,r)=>i.put(e,t,r).then(e=>e.data),delete:(e,t)=>i.delete(e,t).then(e=>e.data),download:(e,t)=>i.get(e,{...t,responseType:"blob"}).then(e=>{const t=window.URL.createObjectURL(new Blob([e.data])),r=document.createElement("a");r.href=t,r.setAttribute("download","file"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}),upload:(e,t,r)=>i.post(e,t,{...r,headers:{"Content-Type":"multipart/form-data"}}).then(e=>e.data)};var c=function(e,t,r,n){var o,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(s<3?o(i):s>3?o(t,r,i):o(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i},l=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class d{isLoggedIn=!1;token=null;refreshToken=null;error=null;constructor(){(0,n.Gn)(this)}login=async(e,t)=>{try{const n=await(r={username:e,password:t},a.post("/api/login",r));this.isLoggedIn=!0,this.token=n.token,this.refreshToken=n.refreshToken,this.error=null,localStorage.setItem("token",this.token),localStorage.setItem("refreshToken",this.refreshToken)}catch(e){this.isLoggedIn=!1,this.token=null,this.refreshToken=null,this.error="登录失败，请检查用户名和密码"}var r};logout=()=>{this.isLoggedIn=!1,this.token=null,this.refreshToken=null,this.error=null,localStorage.removeItem("token"),localStorage.removeItem("refreshToken")}}c([n.sH,l("design:type",Boolean)],d.prototype,"isLoggedIn",void 0),c([n.sH,l("design:type",Object)],d.prototype,"token",void 0),c([n.sH,l("design:type",Object)],d.prototype,"refreshToken",void 0),c([n.sH,l("design:type",Object)],d.prototype,"error",void 0),c([n.XI,l("design:type",Object)],d.prototype,"login",void 0),c([n.XI,l("design:type",Object)],d.prototype,"logout",void 0);var h=d},8559:function(e,t,r){var n={"./Login.store.ts":6260,"./Page1.store.ts":5316,"stores/Login.store.ts":6260,"stores/Page1.store.ts":5316};function o(e){var t=s(e);return r(t)}function s(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=s,e.exports=o,o.id=8559}},function(e){e.O(0,[96,869],function(){return t=2406,e(e.s=t);var t});e.O()}]);
//# sourceMappingURL=main.a1ddfed37e4d3682d307.js.map